---
// Header component
---

<nav class="main-navigation">
  <div class="main-navigation__container w-full max-w-full mx-0 px-3 md:px-4">
    <!-- Bouton hamburger mobile - placé avant le contenu pour le positionner à droite -->
    <button 
      class="main-navigation__toggle md:hidden bg-transparent border-none cursor-pointer z-50" 
      id="mobile-menu-toggle"
      aria-label="Ouvrir le menu de navigation" 
      aria-expanded="false"
    >
      <div class="hamburger-icon flex flex-col gap-1 w-4 h-4">
        <span class="hamburger-line bg-white h-0.5 w-full transition-all"></span>
        <span class="hamburger-line bg-white h-0.5 w-full transition-all"></span>
        <span class="hamburger-line bg-white h-0.5 w-full transition-all"></span>
      </div>
    </button>
    
    <div class="main-navigation__content flex justify-start items-center m-0 py-1.5 md:py-2 pl-3 md:pl-4 relative h-full">
      <!-- Logo -->
      <div class="main-navigation__logo">
        <a href="/" class="main-navigation__logo-link">
          <div class="main-navigation__logo-text text-white">
            <span class="logo-line">West Paris</span>
            <span class="logo-line">Consulting</span>
          </div>
        </a>
      </div>

      <!-- Liens de navigation -->
      <div class="main-navigation__links hidden md:flex gap-5 md:gap-6 items-end" id="desktop-menu" role="navigation" aria-label="Menu principal">
        <a href="/" class="main-navigation__link">
          <span class="main-navigation__link-text">Accueil</span>
          <span class="main-navigation__link-text" aria-hidden="true">Accueil</span>
        </a>
        <a href="/equipe" class="main-navigation__link">
          <span class="main-navigation__link-text">Notre-Équipe</span>
          <span class="main-navigation__link-text" aria-hidden="true">Notre-Équipe</span>
        </a>
        <a href="/contact" class="main-navigation__link">
          <span class="main-navigation__link-text">Contact</span>
          <span class="main-navigation__link-text" aria-hidden="true">Contact</span>
        </a>
        <a href="/nous-rejoindre" class="main-navigation__link">
          <span class="main-navigation__link-text">Nous rejoindre</span>
          <span class="main-navigation__link-text" aria-hidden="true">Nous rejoindre</span>
        </a>
      </div>
      <!-- Menu mobile (caché par défaut) -->
      <div class="main-navigation__links hidden md:hidden fixed top-0 left-0 w-full h-screen z-40 flex flex-col justify-center items-center gap-8" id="mobile-menu" role="navigation" aria-label="Menu principal">
        <a href="/" class="main-navigation__link main-navigation__link--mobile">
          <span class="main-navigation__link-text">Accueil</span>
          <span class="main-navigation__link-text" aria-hidden="true">Accueil</span>
        </a>
        <a href="/equipe" class="main-navigation__link main-navigation__link--mobile">
          <span class="main-navigation__link-text">Notre-Équipe</span>
          <span class="main-navigation__link-text" aria-hidden="true">Notre-Équipe</span>
        </a>
        <a href="/contact" class="main-navigation__link main-navigation__link--mobile">
          <span class="main-navigation__link-text">Contact</span>
          <span class="main-navigation__link-text" aria-hidden="true">Contact</span>
        </a>
        <a href="/nous-rejoindre" class="main-navigation__link main-navigation__link--mobile">
          <span class="main-navigation__link-text">Nous rejoindre</span>
          <span class="main-navigation__link-text" aria-hidden="true">Nous rejoindre</span>
        </a>
      </div>
    </div>
  </div>
</nav>

<script>
  
  import { waitForGSAP, getGSAP } from '../scripts/utils';
  
  document.addEventListener('DOMContentLoaded', async () => {
    let gsap;
    try {
      await waitForGSAP();
      const gsapResult = getGSAP();
      gsap = gsapResult.gsap;
    } catch (error) {
      gsap = null;
    }
    
    // Mobile menu toggle
    const mobileToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const hamburgerLines = document.querySelectorAll('.hamburger-line');
    
    if (!mobileToggle || !mobileMenu) return;

    let isOpen = false;

    mobileToggle.addEventListener('click', () => {
      isOpen = !isOpen;
      mobileToggle.setAttribute('aria-expanded', String(isOpen));
      
      if (gsap) {
        // Menu avec animations GSAP
        if (isOpen) {
          // Ouvrir le menu
          mobileMenu.classList.remove('hidden');
          mobileMenu.classList.add('fixed', 'top-0', 'left-0', 'w-full', 'h-screen', 'z-40', 'flex', 'flex-col', 'justify-center', 'items-center', 'gap-8');
          
          gsap.fromTo(mobileMenu, 
            { x: '-100%', opacity: 0 },
            { x: 0, opacity: 1, duration: 0.5, ease: 'power3.out' }
          );
          
          // Animation des liens
          const links = mobileMenu.querySelectorAll('a');
          gsap.from(links, {
            y: 30,
            opacity: 0,
            stagger: 0.1,
            duration: 0.4,
            ease: 'power2.out',
            delay: 0.2
          });
          
          // Animation hamburger
          hamburgerLines[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
          hamburgerLines[1].style.opacity = '0';
          hamburgerLines[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
        } else {
          // Fermer le menu
          gsap.to(mobileMenu, {
            x: '-100%',
            opacity: 0,
            duration: 0.5,
            ease: 'power3.in',
            onComplete: () => {
              mobileMenu.classList.add('hidden');
              mobileMenu.classList.remove('fixed', 'top-0', 'left-0', 'w-full', 'h-screen', 'z-40', 'flex', 'flex-col', 'justify-center', 'items-center', 'gap-8');
            }
          });
          
          // Réinitialiser hamburger
          hamburgerLines.forEach(line => {
            line.style.transform = '';
            line.style.opacity = '';
          });
        }
      } else {
        // Menu basique sans GSAP (fallback)
        if (isOpen) {
          mobileMenu.classList.remove('hidden');
          mobileMenu.classList.add('fixed', 'top-0', 'left-0', 'w-full', 'h-screen', 'z-40', 'flex', 'flex-col', 'justify-center', 'items-center', 'gap-8');
        } else {
          mobileMenu.classList.add('hidden');
          mobileMenu.classList.remove('fixed', 'top-0', 'left-0', 'w-full', 'h-screen', 'z-40', 'flex', 'flex-col', 'justify-center', 'items-center', 'gap-8');
        }
      }
    });

      // Fermer le menu au clic sur un lien
      const menuLinks = mobileMenu.querySelectorAll('a');
      menuLinks.forEach(link => {
        link.addEventListener('click', () => {
          if (isOpen) {
            mobileToggle.click();
          }
        });
      });
    });

    // Animation hover par lettre pour les liens de navigation
    function setupLetterHoverAnimation() {
      const navLinks = document.querySelectorAll('.main-navigation__link');
      
      navLinks.forEach(link => {
        const textElements = link.querySelectorAll('.main-navigation__link-text');
        
        textElements.forEach(textElement => {
          const text = textElement.textContent.trim();
          const letters = text.split('').map(letter => {
            if (letter === ' ') {
              return '<span class="nav-letter" style="display: inline-block;">&nbsp;</span>';
            }
            return `<span class="nav-letter" style="display: inline-block;">${letter}</span>`;
          }).join('');
          textElement.innerHTML = letters;
        });

        // Animation au hover
        if (gsap) {
          const firstText = link.querySelector('.main-navigation__link-text:first-child');
          const secondText = link.querySelector('.main-navigation__link-text:last-child');
          
          if (firstText && secondText) {
            const firstLetters = firstText.querySelectorAll('.nav-letter');
            const secondLetters = secondText.querySelectorAll('.nav-letter');
            
            link.addEventListener('mouseenter', () => {
              // Animation du premier texte (remonte)
              gsap.to(firstLetters, {
                y: '-100%',
                duration: 0.4,
                stagger: 0.02,
                ease: 'power2.out'
              });
              
              // Animation du second texte (remonte depuis le bas)
              gsap.fromTo(secondLetters, 
                { y: '100%' },
                {
                  y: '0%',
                  duration: 0.4,
                  stagger: 0.02,
                  ease: 'power2.out'
                }
              );
            });
            
            link.addEventListener('mouseleave', () => {
              // Animation inverse
              gsap.to(firstLetters, {
                y: '0%',
                duration: 0.4,
                stagger: 0.02,
                ease: 'power2.out'
              });
              
              gsap.to(secondLetters, {
                y: '100%',
                duration: 0.4,
                stagger: 0.02,
                ease: 'power2.out'
              });
            });
          }
        }
      });
    }

    // Initialiser l'animation des lettres
    if (gsap) {
      setupLetterHoverAnimation();
    }
</script>

<style>
  .main-navigation {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    background: transparent;
    padding: 0;
    margin: 0;
    line-height: 1.2;
    transition: transform 0.3s ease;
    border-bottom: 1px solid transparent;
    z-index: 100;
    opacity: 0;
    animation: fadeInNav 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    will-change: opacity;
  }

  @keyframes fadeInNav {
    0% {
      opacity: 0;
    }
    7% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .main-navigation {
      animation: none;
      opacity: 1;
      transform: translateY(0);
    }
  }

  .main-navigation__container {
    display: flex;
    align-items: center;
    min-height: 48px;
    position: relative;
  }

  .main-navigation__content {
    display: flex;
    align-items: flex-end;
    height: 100%;
    position: relative;
  }

  @media (max-width: 768px) {
    .main-navigation__content {
      align-items: center;
    }
  }

  .main-navigation__logo {
    display: flex;
    align-items: center;
    height: 100%;
    padding-left: 1rem;
    margin-right: 2rem;
  }

  @media (max-width: 768px) {
    .main-navigation__logo {
      padding-top: 0.5rem;
    }
  }

  @media (min-width: 768px) {
    .main-navigation__logo {
      align-items: flex-start;
      padding-left: 1.5rem;
      padding-top: 1rem;
      margin-right: 3rem;
    }
  }

  .main-navigation__links {
    padding-bottom: 0.5rem;
  }

  @media (min-width: 768px) {
    .main-navigation__links {
      padding-bottom: 0.75rem;
    }
  }

  .main-navigation__logo-text {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 700;
    line-height: 1.2;
    letter-spacing: 0.01em;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
  }

  .main-navigation__logo-text .logo-line {
    display: block;
    white-space: nowrap;
  }

  .main-navigation__logo-text .logo-line:first-child {
    margin-bottom: -0.3rem;
  }

  .main-navigation__link {
    text-decoration: none;
    font-family: 'Inter', sans-serif;
    font-weight: 300;
    font-size: 0.875rem;
    letter-spacing: 0.005em;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: flex-start;
    overflow: hidden;
    height: 1.2em;
    line-height: 1.2;
    color: #FFFFFF;
    cursor: pointer;
    width: fit-content;
  }

  .main-navigation__link-text {
    display: block;
    white-space: nowrap;
  }

  .main-navigation__link-text:first-child {
    position: relative;
    z-index: 10;
  }

  .main-navigation__link-text:last-child {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 10;
  }

  .main-navigation__link-text:last-child .nav-letter {
    transform: translateY(100%);
  }

  .nav-letter {
    display: inline-block;
    will-change: transform;
  }

  @media (min-width: 768px) {
    .main-navigation__logo-text {
      font-size: 1.375rem;
      font-weight: 700;
    }
    
    .main-navigation__link {
      font-size: 0.9375rem;
    }
  }

  /* Styles pour le menu mobile */
  .main-navigation__link--mobile {
    font-size: 1.5rem;
    height: 1.5em;
  }
  

  /* Bouton hamburger mobile - positionné par rapport au container */
  .main-navigation__toggle {
    position: absolute;
    top: 50%;
    right: 1rem;
    transform: translateY(-50%);
    padding: 0.75rem;
    z-index: 50;
  }

  .main-navigation__toggle .hamburger-icon {
    width: 1.75rem;
    height: 1.75rem;
    gap: 0.375rem;
  }

  .main-navigation__toggle .hamburger-line {
    height: 0.1875rem;
  }

  @media (min-width: 768px) {
    .main-navigation__toggle {
      display: none;
    }
  }

  @media (max-width: 768px) {
    .main-navigation {
      background: transparent;
    }
    
    .main-navigation__content {
      gap: 0.75rem;
      align-items: center;
    }
  }

  /* Menu mobile - transparent avec overlay léger pour la lisibilité */
  #mobile-menu {
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
  }

  @media (min-width: 768px) {
    .main-navigation__container {
      min-height: 56px;
    }
  }
</style>

